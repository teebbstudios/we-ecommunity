{"version":3,"sources":["index.js","src/request.js","src/class.js","src/helpers/util.js","src/InterceptorManager.js","src/core/dispatchRequest.js","src/defaults.js"],"names":[],"mappings":";;;;;;;AAAA;AACA;AACA;ACFA;AACA;AACA;ACFA,ADGA;ACFA,ADGA;ACFA,ADGA;ACFA,ACHA,AFMA;ACFA,ACHA,AFMA;ACFA,ACHA,AFMA;AGRA,AFMA,ACHA,AFMA;AGRA,AFMA,ACHA,AFMA;AGRA,AFMA,ACHA,AFMA;AGRA,AFMA,AGTA,AFMA,AFMA;AGRA,AFMA,AGTA,AFMA,AFMA;AGRA,AFMA,AGTA,AFMA,AFMA;AGRA,AFMA,AGTA,ACHA,AHSA,AFMA;AGRA,AFMA,AGTA,ACHA,AHSA,AFMA;AGRA,AFMA,AGTA,ACHA,AHSA,AFMA;AGRA,AFMA,AGTA,ACHA,AHSA,AFMA;AGRA,AFMA,AGTA,ACHA,AHSA,AFMA;AGRA,AFMA,AGTA,ACHA,AHSA,AFMA;AGRA,AFMA,AGTA,ACHA,AHSA,AFMA;AGRA,AFMA,AGTA,ACHA,AHSA,AFMA;AGRA,AFMA,AGTA,ACHA,AHSA,AFMA;AGRA,AFMA,AGTA,ACHA,AHSA,AFMA;AGRA,AFMA,AGTA,ACHA,AHSA,AFMA;AGRA,AFMA,AGTA,ACHA,AHSA,AFMA;AGRA,AFMA,AGTA,ACHA,AHSA,AFMA;AGRA,AFMA,AGTA,ACHA,AHSA,AFMA;AGRA,AFMA,AGTA,ACHA,AHSA,AFMA;AGRA,AFMA,AGTA,ACHA,AHSA,AFMA;AGRA,AFMA,AGTA,ACHA,AHSA,AFMA;AGRA,AFMA,AGTA,ACHA,AHSA,AFMA;AGRA,AFMA,AGTA,ACHA,AHSA,AFMA;AGRA,AFMA,AGTA,ACHA,AHSA,AFMA;AGRA,AFMA,AGTA,ACHA,AHSA,AFMA;AGRA,AFMA,AGTA,ACHA,AHSA,AFMA;AGRA,AFMA,AGTA,ACHA,AHSA,AFMA;ACFA,AGTA,ACHA,AHSA,AFMA;ACFA,AGTA,ACHA,AHSA,AFMA;ACFA,AGTA,ACHA,AHSA;ADIA,AGTA,ACHA,AHSA;ADIA,AGTA,ACHA,AHSA;ADIA,AGTA,ACHA,AHSA;ADIA,AGTA,ACHA,AHSA;ADIA,AGTA,ACHA,AHSA;ADIA,AGTA,ACHA,AHSA;ADIA,AGTA,ACHA,AHSA;ADIA,AGTA,ACHA,AHSA;ADIA,AGTA,ACHA,AHSA;ADIA,AGTA,ACHA,AHSA;ADIA,AGTA,ACHA,AHSA;ADIA,AGTA,ACHA,AHSA;ADIA,AGTA,ACHA,AHSA;ADIA,AGTA,ACHA,AHSA;ADIA,AGTA,ACHA,AHSA;ADIA,AGTA,ACHA,AHSA;ADIA,AGTA,ACHA,AHSA;ADIA,AGTA,ACHA,AHSA;ADIA,AGTA,ACHA,AHSA;ADIA,AGTA,AFMA;ADIA,AGTA,AFMA;ADIA,AGTA,AFMA;ADIA,AGTA,AFMA;ADIA,AGTA,AFMA;ADIA,AGTA,AFMA;AELA,AFMA;AELA,AFMA;AELA,AFMA;AELA,AFMA;AELA,AFMA;AELA,AFMA;AELA,AFMA;AELA,AFMA;AELA,AFMA;AELA,AFMA;AELA,AFMA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"index.js","sourcesContent":["var __TEMP__ = require('./src/request');var request = __REQUIRE_DEFAULT__(__TEMP__);\nif (!exports.__esModule) Object.defineProperty(exports, \"__esModule\", { value: true });exports.default = request;\n","\r\n\r\n\r\n\r\n\r\n\r\n\r\nvar __TEMP__ = require('./class');var Request = __REQUIRE_DEFAULT__(__TEMP__);\r\nvar __TEMP__ = require('./helpers/util');var util = __REQUIRE_WILDCARD__(__TEMP__);\r\nvar __TEMP__ = require('./defaults');var defaults = __REQUIRE_DEFAULT__(__TEMP__);\r\n\r\n\r\nfunction createInstance(config) {\r\n    let context = new Request(config);\r\n    let instance = util.bind( Request.prototype.request , context );\r\n    util.extend( instance , Request.prototype , context );\r\n    util.extend( instance , context );\r\n    return instance;\r\n}\r\n\r\nlet request = createInstance(defaults);\r\n\r\n\r\n// 用于创建多个实例\r\nrequest.create = function (config) {\r\n    return createInstance(util.merge(defaults, config));\r\n};\r\n\r\n// 并发请求数据处理\r\nrequest.spread = function (callback){\r\n    return function (...arg) {\r\n        return callback.apply(null , [...arg] );\r\n    };\r\n};\r\n\r\n\r\nif (!exports.__esModule) Object.defineProperty(exports, \"__esModule\", { value: true });exports.default = request; \r\n\r\n\r\n","var __TEMP__ = require('./helpers/util');var util = __REQUIRE_WILDCARD__(__TEMP__);\nvar __TEMP__ = require('./InterceptorManager');var InterceptorManager = __REQUIRE_DEFAULT__(__TEMP__);\nvar __TEMP__ = require('./core/dispatchRequest');var dispatchRequest = __TEMP__['dispatchRequest'];\n\nclass Request {\n    constructor( config ){\n        this.defaults = config;\n        this.interceptors = {\n            request: new InterceptorManager(),\n            response: new InterceptorManager()\n        };\n    }\n    request( config ){\n        if( typeof config === \"string\"){\n            config = util.merge({url: arguments[0]}, arguments[1]);\n        }\n\n        config = util.deepMerge(this.defaults , config );\n        config.method = config.method ? config.method.toLowerCase() : \"get\" ;\n\n        let chain = [dispatchRequest, undefined];\n        let promise = Promise.resolve( config );\n\n        this.interceptors.request.forEach(function(interceptor) {\n            chain.unshift(interceptor.fulfilled, interceptor.rejected);\n        });\n\n        this.interceptors.response.forEach(function(interceptor) {\n            chain.push(interceptor.fulfilled, interceptor.rejected);\n        });\n\n        while (chain.length) {\n            promise = promise.then(chain.shift(), chain.shift());\n        }\n\n        return promise;\n    }\n    all (promises){\n        return Promise.all(promises);\n    }\n}\n\n[\"delete\", \"get\", \"head\", \"options\", \"trace\"].forEach(method => {\n    Request.prototype[method] = function ( url,config ) {\n        return this.request( util.merge(config || {} ,{\n            method,\n            url\n        }) );\n    };\n});\n\n[\"post\", \"put\", \"patch\" ].forEach(method => {\n    Request.prototype[method] = function ( url, data, config ) {\n        return this.request( util.merge(config || {} ,{\n            method,\n            url,\n            data\n        }) );\n    };\n});\n\nif (!exports.__esModule) Object.defineProperty(exports, \"__esModule\", { value: true });exports.default = Request;\n","if (!exports.__esModule) Object.defineProperty(exports, \"__esModule\", { value: true });var bind = exports.bind = function(fn,thisArg){\n    return function warp(){\n        return fn.apply(thisArg , Array.from(arguments) );\n    };\n};\n\nif (!exports.__esModule) Object.defineProperty(exports, \"__esModule\", { value: true });var extend = exports.extend = function (a,b, thisArg) {\n    let o = Object.getOwnPropertyNames( b );\n    o.forEach(attr => {\n        if(thisArg && typeof b[attr] === \"function\" ){\n            a[attr] = bind( b[attr] , thisArg );\n        }else{\n            a[attr] = b[attr];\n        }\n    });\n    return a;\n};\n\nif (!exports.__esModule) Object.defineProperty(exports, \"__esModule\", { value: true });var copyobj = exports.copyobj = function( a, b ){\n    return Object.assign( {} , a ,b );\n};\n\n\nif (!exports.__esModule) Object.defineProperty(exports, \"__esModule\", { value: true });var merge = exports.merge = function(){\n    var result = {};\n    Array.from(arguments).forEach( e =>{\n        for(let key in e){\n            if( e[key] && typeof e[key] === \"object\" && !isEmptyObject(e[key]) ){\n                merge( result[key] , e[key] );\n            }\n            result[key] = e[key];\n        }\n    });\n    return result;\n};\n\n\n\nif (!exports.__esModule) Object.defineProperty(exports, \"__esModule\", { value: true });var deepMerge = exports.deepMerge = function () {\n    let result = {};\n    Array.from(arguments).forEach(e =>{\n        if( e && typeof e === \"object\" && !isEmptyObject(e) ) {\n            Object.keys(e).forEach( key => {\n                if( e[key] && typeof e[key] === \"object\"){\n                    result[key] = deepMerge( result[key] , e[key] );\n                }\n                result[key] = e[key];\n            });\n        }\n    });\n    return result ;\n};\n\n\nif (!exports.__esModule) Object.defineProperty(exports, \"__esModule\", { value: true });var isEmptyObject = exports.isEmptyObject = obj => {\n    return Object.getOwnPropertyNames(obj).length === 0;\n};\n\nif (!exports.__esModule) Object.defineProperty(exports, \"__esModule\", { value: true });var isObject = exports.isObject = obj => {\n    return obj !== null && typeof obj === \"object\";\n};\n\nif (!exports.__esModule) Object.defineProperty(exports, \"__esModule\", { value: true });var combineURLs = exports.combineURLs = function (baseURL, relativeURL) {\n    return relativeURL\n        ? baseURL.replace(/\\/+$/, \"\") + \"/\" + relativeURL.replace(/^\\/+/, \"\")\n        : baseURL;\n};\n\n\n\nfunction encode(val) {\n    return encodeURIComponent(val).\n        replace(/%40/gi, \"@\").\n        replace(/%3A/gi, \":\").\n        replace(/%24/g, \"$\").\n        replace(/%2C/gi, \",\").\n        replace(/%20/g, \"+\").\n        replace(/%5B/gi, \"[\").\n        replace(/%5D/gi, \"]\");\n}\nif (!exports.__esModule) Object.defineProperty(exports, \"__esModule\", { value: true });var buildURL = exports.buildURL = function ( url , paramsObject ){\n    if( !paramsObject || isEmptyObject(paramsObject) ) return url;\n    let parts = [];\n    Object.keys( paramsObject ).forEach(key =>{\n        parts.push( encode(key) + \"=\" + encode( paramsObject[key] ) );\n    });\n    return url += ( url.indexOf(\"?\") === -1 ? \"?\" : \"&\" ) + parts.join(\"&\");\n};\n\nif (!exports.__esModule) Object.defineProperty(exports, \"__esModule\", { value: true });var isAbsoluteURL = exports.isAbsoluteURL = function (url) {\n    return /^([a-z][a-z\\d+\\-.]*:)?\\/\\//i.test(url);\n};\n\nif (!exports.__esModule) Object.defineProperty(exports, \"__esModule\", { value: true });var buildData = exports.buildData = data => {\n    if( !isObject(data) || isEmptyObject(data) ) return {};\n    const result = {};\n    Object.keys(data).forEach( key => {\n        if (data[key] !== null && typeof data[key] !== \"undefined\") {\n            result[key] = data[key];\n        }\n    });\n    return result;\n};\n","if (!exports.__esModule) Object.defineProperty(exports, \"__esModule\", { value: true });class InterceptorManager{\n    constructor(){\n        this.handlers = [];\n    }\n\n    use(fulfilled, rejected){\n        this.handlers.push({\n            fulfilled,\n            rejected\n        });\n        return this.handlers.length - 1;\n    }\n\n    eject(id){\n        if( this.handlers[id] ){\n            this.handlers[id] = null;\n        }\n    }\n\n    forEach(fn){\n        this.handlers.forEach(e =>{\n            if(e !== null ){\n                fn(e);\n            }\n        });\n    }\n};exports.default = InterceptorManager\n\n","var __TEMP__ = require('../helpers/util');var util = __REQUIRE_WILDCARD__(__TEMP__);\nif (!exports.__esModule) Object.defineProperty(exports, \"__esModule\", { value: true });var dispatchRequest = exports.dispatchRequest = function (config) {\n\n    if (config.baseURL && !util.isAbsoluteURL(config.url)) {\n        config.url = util.combineURLs(config.baseURL, config.url);\n    }\n\n    config.url = util.buildURL( config.url , config.params );\n\n    config.data = util.merge(\n        config.data ,\n        config.transformRequest(config.data)\n    );\n\n    config.headers = util.merge(\n        config.headers.common || {},\n        config.headers[config.method] || {},\n        config.headers || {},\n    );\n\n    let methods = [\"delete\", \"get\", \"head\", \"post\", \"put\", \"patch\", \"common\"];\n    methods.forEach(method => {\n        delete config.headers[method];\n    });\n\n    let promise = Promise.resolve( config );\n    promise = promise.then( config => {\n        return new Promise(function(resolve, reject) {\n            let requestTask =  wx.request({\n                url : config.url ,\n                data : util.buildData(config.data),\n                header : config.headers,\n                method : config.method,\n                dataType : config.dataType,\n                success : function (res) {\n                    resolve({\n                        data : res.data ,\n                        headers : res.header,\n                        status : res.statusCode,\n                        statusText : \"ok\"\n                    });\n                },\n                fail : function (err) {\n                    reject(err);\n                },\n                complete :  function () {\n                    config.complete && config.complete();\n                }\n            });\n\n            if( config.timeout && typeof config.timeout === \"number\" && config.timeout > 1000 ){\n                setTimeout(() =>{\n                    requestTask.abort();\n                    resolve({\n                        status : \"canceled\"\n                    });\n                },config.timeout);\n            }\n        });\n    });\n\n    return promise;\n};\n\n","\n\nvar __TEMP__ = require('./helpers/util');var util = __REQUIRE_WILDCARD__(__TEMP__);\n\nlet DEFAULT_CONTENT_TYPE = {\n    \"Content-Type\": \"application/x-www-form-urlencoded\"\n};\n\nvar defaults = {\n    method: \"get\", // default\n    // baseURL: '',\n    dataType : \"json\",\n    responseType : \"text\",\n    // timeout: 0,\n    headers: {},\n\n    // params : {},\n\n    transformRequest (data) {\n        return data;\n    },\n\n    // transformResponse (data) {\n    //     return data;\n    // },\n\n    // validateStatus ( status ) {\n    //     return status >= 200 && status < 300\n    // }\n\n};\n\ndefaults.headers = {\n    common: {\n        \"Accept\": \"application/json, text/plain, */*\"\n    }\n};\n\n[\"delete\",\"get\", \"head\",\"post\", \"put\", \"patch\"].map(e => {\n    defaults.headers[e] = util.merge( defaults.headers , DEFAULT_CONTENT_TYPE);\n});\n\n\nif (!exports.__esModule) Object.defineProperty(exports, \"__esModule\", { value: true });exports.default = defaults;\n"]}